{% extends 'base.html' %}
{% block title %}Registrar Pr√©stamo{% endblock %}

{% block content %}
<div class="d-flex flex-column gap-3">
    <div>
        <h2 class="text-accent fw-semibold mb-2">Registrar pr√©stamo</h2>
        <p class="card-main-lead mb-0">
            Completa los campos para registrar un nuevo pr√©stamo de materiales.
        </p>
    </div>

    {% if mensaje %}
        <div class="alert alert-success mt-2 py-2">
            ‚úÖ {{ mensaje }}
        </div>
    {% endif %}
    {% if error %}
        <div class="alert alert-danger mt-2 py-2">
            ‚ö†Ô∏è {{ error }}
        </div>
    {% endif %}

    <form method="post" class="mt-2 p-3">
        {% csrf_token %}
        {{ form.as_p }}

        <div class="mb-3">
            <label for="materialSelect" class="form-label text-white">Selecciona material</label>
            <select id="materialSelect" class="form-select">
                <option value="">-- Selecciona --</option>
                {% for m in materiales %}
                    <option value="{{ m.id }}" data-stock="{{ m.stock }}">{{ m.nombre }}</option>
                {% endfor %}
            </select>
        </div>

        <div id="stockInfo" class="alert alert-info d-none"></div>

        <div class="d-flex flex-wrap gap-2 mt-3">
            <button class="btn btn-success px-4" type="submit">
                üíæ Registrar
            </button>
            <a class="btn btn-outline-light px-4" href="{% url 'prestamo_list' %}">
                Ver pr√©stamos
            </a>
        </div>
    </form>
</div>

<script>
document.getElementById('materialSelect').addEventListener('change', function() {
    const selected = this.options[this.selectedIndex];
    const stock = selected.getAttribute('data-stock');
    const info = document.getElementById('stockInfo');
    if (stock) {
        info.textContent = `Stock disponible: ${stock}`;
        info.classList.remove('d-none');
    } else {
        info.classList.add('d-none');
    }
});
</script>
{% endblock %}
