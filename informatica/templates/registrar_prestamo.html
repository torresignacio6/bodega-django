{% extends 'base.html' %}
{% block title %}Registrar Préstamo{% endblock %}

{% block content %}
<h2>Registrar Préstamo</h2>

{% if mensaje %}
    <div class="alert alert-success">{{ mensaje }}</div>
{% endif %}
{% if error %}
    <div class="alert alert-danger">{{ error }}</div>
{% endif %}

<form method="post">
    {% csrf_token %}
    {{ form.as_p }}

    <div class="mb-3">
        <label for="material">Material:</label>
        <select id="material" name="material" class="form-control">
            <option value="">Seleccione un material...</option>
            {% for m in materiales %}
            <option value="{{ m.id }}" data-stock="{{ m.stock }}">{{ m.nombre }}</option>
            {% endfor %}
        </select>
        <small id="stock-info" class="form-text text-muted"></small>
    </div>

    <button class="btn btn-success" type="submit">Registrar</button>
    <a class="btn btn-secondary" href="{% url 'prestamo_list' %}">Ver préstamos</a>
</form>

<script>
    const materialSelect = document.getElementById('material');
    const stockInfo = document.getElementById('stock-info');

    materialSelect.addEventListener('change', () => {
        const selected = materialSelect.options[materialSelect.selectedIndex];
        const stock = selected.getAttribute('data-stock');
        if (stock) {
            stockInfo.textContent = `Stock disponible: ${stock} unidades.`;
        } else {
            stockInfo.textContent = '';
        }
    });
</script>
{% endblock %}
